<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Token刷新方案 | 含光 の Blog</title><meta name="author" content="含光"><meta name="copyright" content="含光"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Token 刷新方案在这篇文章中，我想写最近在做项目的时候使用的 token 刷新机制。 在上一篇 Spring Security 的文章中，在 login 中我使用 id 作为 key 来创建 token，token 最大生存周期为 7 天，将 token 和用户信息存入 Redis 的时候并没有设置过期时间，这意味着除非用户 logout，用户信息将在 Redis 中持续存在，若 token">
<meta property="og:type" content="article">
<meta property="og:title" content="Token刷新方案">
<meta property="og:url" content="https://zuowanghang.github.io/2024/03/10/Token%E5%88%B7%E6%96%B0%E6%96%B9%E6%A1%88/index.html">
<meta property="og:site_name" content="含光 の Blog">
<meta property="og:description" content="Token 刷新方案在这篇文章中，我想写最近在做项目的时候使用的 token 刷新机制。 在上一篇 Spring Security 的文章中，在 login 中我使用 id 作为 key 来创建 token，token 最大生存周期为 7 天，将 token 和用户信息存入 Redis 的时候并没有设置过期时间，这意味着除非用户 logout，用户信息将在 Redis 中持续存在，若 token">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2024/03/10/hDBv4ZPxlJOCGET.png">
<meta property="article:published_time" content="2024-03-10T11:07:40.000Z">
<meta property="article:modified_time" content="2025-05-16T17:43:46.987Z">
<meta property="article:author" content="含光">
<meta property="article:tag" content="Spring Boot">
<meta property="article:tag" content="Redis">
<meta property="article:tag" content="Spring Security">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2024/03/10/hDBv4ZPxlJOCGET.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Token刷新方案",
  "url": "https://zuowanghang.github.io/2024/03/10/Token%E5%88%B7%E6%96%B0%E6%96%B9%E6%A1%88/",
  "image": "https://s2.loli.net/2024/03/10/hDBv4ZPxlJOCGET.png",
  "datePublished": "2024-03-10T11:07:40.000Z",
  "dateModified": "2025-05-16T17:43:46.987Z",
  "author": [
    {
      "@type": "Person",
      "name": "含光",
      "url": "https://zuowanghang.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://zuowanghang.github.io/2024/03/10/Token%E5%88%B7%E6%96%B0%E6%96%B9%E6%A1%88/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":true,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"已切换为繁体中文","cht_to_chs":"已切换为简体中文","day_to_night":"已切换为深色模式","night_to_day":"已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-center"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Token刷新方案',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 5.4.2"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load', preloader.endLoading)

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="web_bg" style="background-image: url(https://s2.loli.net/2023/03/08/Jpm9kMb1ez4OixU.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://s2.loli.net/2022/11/30/m3onYl1iO4ZuwT8.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">10</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">13</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://s2.loli.net/2024/03/10/hDBv4ZPxlJOCGET.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">含光 の Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">Token刷新方案</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Token刷新方案</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-03-10T11:07:40.000Z" title="发表于 2024-03-10 19:07:40">2024-03-10</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-05-16T17:43:46.987Z" title="更新于 2025-05-17 01:43:46">2025-05-17</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/">问题解决</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">698</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>2分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="Token-刷新方案"><a href="#Token-刷新方案" class="headerlink" title="Token 刷新方案"></a>Token 刷新方案</h1><p>在这篇文章中，我想写最近在做项目的时候使用的 token 刷新机制。</p>
<p>在上一篇 Spring Security 的文章中，在 login 中我使用 id 作为 key 来创建 token，token 最大生存周期为 7 天，将 token 和用户信息存入 Redis 的时候并没有设置过期时间，这意味着除非用户 logout，用户信息将在 Redis 中持续存在，若 token 过期则用户必须重新登录，此过程中需要删除原有 token（在 Redis 中以<code>&quot;login:&quot; + current.getId()</code>为 key 存储了 token，以<code>&quot;token:&quot;</code>为 key 存储了用户信息），导致不必要的开销，并且 token 刷新做的比较粗糙。</p>
<h2 id="Token-生存期"><a href="#Token-生存期" class="headerlink" title="Token 生存期"></a>Token 生存期</h2><p>翻阅资料得知，创建 token 时如果不指定过期时间，则 token 永久有效，可以通过给 Redis 中存储的用户信息设置过期时间，在用户长时间无操作的情况下，强制用户下线。</p>
<p>经过他人点拨和头脑风暴之后，我重新整理了 Redis 存储用户信息的方式。以 token 作为 key 存储用户信息，将 Redis 中用户信息过期时间设置为 24 小时，用户访问资源时，在过滤器中实现 token 续签（若 token 有效期在 30 分钟以内，则将 token 过期时间向后推一天）。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不指定 token 过期时间，Redis中 token 过期则无法访问资源</span></span><br><span class="line"><span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> JwtTokenUtil.createToken(Integer.toString(currentUser.getId()), <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将 redis 中存储方式改为如下方案，过期时间设置为一天</span></span><br><span class="line">redisUtil.set(token, loginUser, <span class="number">3600</span> * <span class="number">24</span>);</span><br></pre></td></tr></table></figure>

<p>这种情况下，用户需要途径得知自己手中的 token 是否可用，即 token 是否已经过期:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redisUtil.getExpire(token)</span><br></pre></td></tr></table></figure>

<p>上面一行代码可用于查询 token 过期时间，得到的值为  -2 说明已经过期， -1 说明永久有效，大于 0 表示再过多长时间（时间单位可以自定义）。</p>
<p>过滤器中续签 token：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (redisUtil.getExpire(token) &lt; <span class="number">30</span> * <span class="number">60</span>) &#123;</span><br><span class="line">    <span class="comment">// 将过期时间延长一天</span></span><br><span class="line">    redisUtil.expire(token, <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将用户信息存进 securityContextHolder 中</span></span><br><span class="line"><span class="type">UsernamePasswordAuthenticationToken</span> <span class="variable">authenticationToken</span> <span class="operator">=</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">UsernamePasswordAuthenticationToken</span>(loginUser, <span class="literal">null</span>, loginUser.getAuthorities());</span><br><span class="line">SecurityContextHolder.getContext().setAuthentication(authenticationToken);</span><br></pre></td></tr></table></figure>

<p>token 过期的情况下，一定要重新登录。</p>
<h2 id="再遇问题"><a href="#再遇问题" class="headerlink" title="再遇问题"></a>再遇问题</h2><p>按照上面方法在 Redis 中存储数据确实较为方便，但是也带来了一些问题。</p>
<p>当用户需要修改用户名、密码等账户信息的时候，需要传入 token 以达到更新 Redis 中用户信息的目的。但是传入 token 是让我不能够容忍的，因此，需要重新考虑用户信息在 Redis 中的存储方式。</p>
<p>采用以用户 id 为 key 存储用户信息的方式，在 User 实体中加入 token 字段，用于校验 token 可用性。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://Zuowanghang.github.io">含光</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://zuowanghang.github.io/2024/03/10/Token%E5%88%B7%E6%96%B0%E6%96%B9%E6%A1%88/">https://zuowanghang.github.io/2024/03/10/Token%E5%88%B7%E6%96%B0%E6%96%B9%E6%A1%88/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://Zuowanghang.github.io" target="_blank">含光 の Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Spring-Boot/">Spring Boot</a><a class="post-meta__tags" href="/tags/Redis/">Redis</a><a class="post-meta__tags" href="/tags/Spring-Security/">Spring Security</a></div><div class="post-share"><div class="social-share" data-image="https://s2.loli.net/2024/03/10/hDBv4ZPxlJOCGET.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2024/03/05/Spring-Security/" title="Spring Security"><img class="cover" src="https://s2.loli.net/2024/03/05/6EC5F1ealYO9ukm.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Spring Security</div></div><div class="info-2"><div class="info-item-1">Introduction认证方式首先介绍基于 session 的认证流程：在用户登录成功之后，在服务端生成用户相关的数据保存在session 中， 发送给客户端请求时带上 session_id 就可以验证服务器是不是存在 session 的数据，以此完成用户的合法校验，当用户退出系统或者 session 过期销毁时，客户端的 session 就失效（session 是存在 tomcat 服务器中的）。 而基于 token 的认证方式，交互流程是：在用户认证成功之后，服务器僧成一个 token，发送给客户端，客户算可以将 token 放在 cookie 或者 localStorage 中存储，每次请求的时候带上这个 token，服务器收到 token 通过验证即可确认用户身份（不强制要求 token 存储在哪里）。 基于 session 的认证方式由 Servlet 规范定制服务端存储 session，服务端存储 session Cincinnati需要占用内存资源，客户端需要支持 cookie；而基于 token 的方式一般不需要在服务端存储...</div></div></div></a><a class="pagination-related" href="/2026/01/16/Manjaro/" title="Manjaro"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Manjaro</div></div><div class="info-2"><div class="info-item-1">安装 iso 镜像 – https://manjaro.org/products/download/x86 选择 KDE Plasma 启动盘制作 – rufus Dell 笔记本 F2 进入 BIOS 关闭安全启动 Boot with open source drivers Manjaro Hello -&gt; Launch installer 用户界面中接入网络 时区 Asia&#x2F;Shanghai，输入法 default 分区 –&gt; Erase Disk -&gt; ext4 16GB 交换分区 设置用户名，暂时不配置 office 选项 安装  安装后配置更新软件源（有没有UI都行） 1sudo pacman-mirrors -i -c China -m rank    在弹出的界面中选择速度比较快的加入到镜像文件中 更新软件源 1sudo pacman -Syu    使用 AUR 1sudo pacman -Sy yay    /etc/pacman.conf 中配置 Archlinux 镜像 1234Server =...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2024/03/05/Spring-Security/" title="Spring Security"><img class="cover" src="https://s2.loli.net/2024/03/05/6EC5F1ealYO9ukm.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-05</div><div class="info-item-2">Spring Security</div></div><div class="info-2"><div class="info-item-1">Introduction认证方式首先介绍基于 session 的认证流程：在用户登录成功之后，在服务端生成用户相关的数据保存在session 中， 发送给客户端请求时带上 session_id 就可以验证服务器是不是存在 session 的数据，以此完成用户的合法校验，当用户退出系统或者 session 过期销毁时，客户端的 session 就失效（session 是存在 tomcat 服务器中的）。 而基于 token 的认证方式，交互流程是：在用户认证成功之后，服务器僧成一个 token，发送给客户端，客户算可以将 token 放在 cookie 或者 localStorage 中存储，每次请求的时候带上这个 token，服务器收到 token 通过验证即可确认用户身份（不强制要求 token 存储在哪里）。 基于 session 的认证方式由 Servlet 规范定制服务端存储 session，服务端存储 session Cincinnati需要占用内存资源，客户端需要支持 cookie；而基于 token 的方式一般不需要在服务端存储...</div></div></div></a><a class="pagination-related" href="/2023/03/25/Docker-%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/" title="Docker 安装使用"><img class="cover" src="https://s2.loli.net/2023/03/08/uGwMa9pFQIkbYRe.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-25</div><div class="info-item-2">Docker 安装使用</div></div><div class="info-2"><div class="info-item-1">Docker 安装Docker 对 Linux 内核的版本有些要求，使用命令验证内核和架构信息： 1uname - a  内核版本高于 3.10 即可。 更新软件源： 123sudo apt updatesudo apt upgradesudo apt full-upgrade    安装必要的证书并允许 apt 管理器使用以下命令通过 Https 使用存储库： 1sudo apt install apt-transport-https ca-certificates curl software-properties-common gnupg lsb-release    运行下列命令添加 docker 的官方 GPG 密钥： 1curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg    添加 docker 官方库: 1echo &quot;deb [arch=$(dpkg...</div></div></div></a><a class="pagination-related" href="/2022/12/05/Spring/" title="Spring 笔记"><img class="cover" src="https://s2.loli.net/2023/03/08/7Y9Z5zTQL4UFX1S.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-05</div><div class="info-item-2">Spring 笔记</div></div><div class="info-2"><div class="info-item-1">Spring 简化开发： IOC AOP – 事务处理   框架整合 mybatis mybatis-plus ……      重点：Spring中操作与思想的联系是学习的重点    官网：spring.io EJB思想（Enterprise Java Beans）：企业 Java Beans，是基于分布式事务处理的企业级应用程序的组件。   Core Container：盛放对象（一切操作都基于对象） Data Access&#x2F;Integration：DAO AOP Aspects：面向切面编程 Transactions 事务处理   Part I 核心容器  核心概念 IOC&#x2F;DI 容器基本操作   Part II 整合  整合数据层的 mybatis 和 mybatis-plus   Part III AOP  基础AOP AOP实用操作   Part IV Transactions  事务概念，事务实用操作    IOC &amp; DI IOC（Inversion Of...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://s2.loli.net/2022/11/30/m3onYl1iO4ZuwT8.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">含光</div><div class="author-info-description">有朋自远方来，不亦乐乎</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">10</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">13</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Zuowanghang"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Zuowanghang" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:wastont9@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">Wonderland</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Token-%E5%88%B7%E6%96%B0%E6%96%B9%E6%A1%88"><span class="toc-number">1.</span> <span class="toc-text">Token 刷新方案</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Token-%E7%94%9F%E5%AD%98%E6%9C%9F"><span class="toc-number">1.1.</span> <span class="toc-text">Token 生存期</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%8D%E9%81%87%E9%97%AE%E9%A2%98"><span class="toc-number">1.2.</span> <span class="toc-text">再遇问题</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2026/01/16/Manjaro/" title="Manjaro"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Manjaro"/></a><div class="content"><a class="title" href="/2026/01/16/Manjaro/" title="Manjaro">Manjaro</a><time datetime="2026-01-16T15:38:04.000Z" title="发表于 2026-01-16 23:38:04">2026-01-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/03/10/Token%E5%88%B7%E6%96%B0%E6%96%B9%E6%A1%88/" title="Token刷新方案"><img src="https://s2.loli.net/2024/03/10/hDBv4ZPxlJOCGET.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Token刷新方案"/></a><div class="content"><a class="title" href="/2024/03/10/Token%E5%88%B7%E6%96%B0%E6%96%B9%E6%A1%88/" title="Token刷新方案">Token刷新方案</a><time datetime="2024-03-10T11:07:40.000Z" title="发表于 2024-03-10 19:07:40">2024-03-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/03/05/Spring-Security/" title="Spring Security"><img src="https://s2.loli.net/2024/03/05/6EC5F1ealYO9ukm.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spring Security"/></a><div class="content"><a class="title" href="/2024/03/05/Spring-Security/" title="Spring Security">Spring Security</a><time datetime="2024-03-05T15:28:25.000Z" title="发表于 2024-03-05 23:28:25">2024-03-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/07/05/Git%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/" title="Git基本使用"><img src="https://s2.loli.net/2023/07/05/861CKPQyzvYj9Vk.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Git基本使用"/></a><div class="content"><a class="title" href="/2023/07/05/Git%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/" title="Git基本使用">Git基本使用</a><time datetime="2023-07-05T13:13:23.000Z" title="发表于 2023-07-05 21:13:23">2023-07-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/03/25/Docker-%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/" title="Docker 安装使用"><img src="https://s2.loli.net/2023/03/08/uGwMa9pFQIkbYRe.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Docker 安装使用"/></a><div class="content"><a class="title" href="/2023/03/25/Docker-%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/" title="Docker 安装使用">Docker 安装使用</a><time datetime="2023-03-25T14:11:38.000Z" title="发表于 2023-03-25 22:11:38">2023-03-25</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(https://s2.loli.net/2024/03/10/hDBv4ZPxlJOCGET.png);"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2026 By 含光</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 5.4.2</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">簡</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (false) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"left"},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>