<!DOCTYPE html><html lang="zh_TW" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>含光 の Blog | 含光 の Blog</title><meta name="author" content="含光"><meta name="copyright" content="含光"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Docker 安装 最近腾讯云租了一台轻量级应用服务器。系统选择的是Ubuntu22.04，用于软件工程课程设计等。 Docker 对 Linux 内核的版本有些要求，使用命令验证内核和架构信息： uname - a  内核版本高于 3.10 即可。 更新软件源： sudo apt update sudo apt upgrade sudo apt full-upgrade  安装必要的证书并允许">
<meta property="og:type" content="article">
<meta property="og:title" content="含光 の Blog">
<meta property="og:url" content="https://zuowanghang.github.io/2023/03/25/Docker-%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/index.html">
<meta property="og:site_name" content="含光 の Blog">
<meta property="og:description" content="Docker 安装 最近腾讯云租了一台轻量级应用服务器。系统选择的是Ubuntu22.04，用于软件工程课程设计等。 Docker 对 Linux 内核的版本有些要求，使用命令验证内核和架构信息： uname - a  内核版本高于 3.10 即可。 更新软件源： sudo apt update sudo apt upgrade sudo apt full-upgrade  安装必要的证书并允许">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg">
<meta property="article:published_time" content="2023-03-25T14:11:38.816Z">
<meta property="article:modified_time" content="2023-06-17T09:10:11.478Z">
<meta property="article:author" content="含光">
<meta property="article:tag" content="编程">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://zuowanghang.github.io/2023/03/25/Docker-%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '含光 の Blog',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2023-06-17 17:10:11'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.2"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><script>const preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> { preloader.endLoading() })

if (false) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://s2.loli.net/2022/11/30/m3onYl1iO4ZuwT8.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">6</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">2</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="含光 の Blog"><span class="site-name">含光 の Blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">No title</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-03-25T14:11:38.816Z" title="Created 2023-03-25 22:11:38">2023-03-25</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2023-06-17T09:10:11.478Z" title="Updated 2023-06-17 17:10:11">2023-06-17</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>Docker 安装</p>
<p>最近腾讯云租了一台轻量级应用服务器。系统选择的是Ubuntu22.04，用于软件工程课程设计等。</p>
<p>Docker 对 Linux 内核的版本有些要求，使用命令验证内核和架构信息：</p>
<pre><code>uname - a
</code></pre>
<p>内核版本高于 3.10 即可。</p>
<p>更新软件源：</p>
<pre><code>sudo apt update
sudo apt upgrade
sudo apt full-upgrade
</code></pre>
<p>安装必要的证书并允许 apt 管理器使用以下命令通过 Https 使用存储库：</p>
<pre><code>sudo apt install apt-transport-https ca-certificates curl software-properties-common gnupg lsb-release
</code></pre>
<p>运行下列命令添加 docker 的官方 GPG 密钥：</p>
<pre><code>curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
</code></pre>
<p>添加 docker 官方库:</p>
<pre><code>echo &quot;deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable&quot; | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null
</code></pre>
<p>使用命令更新 Ubuntu 软件源：</p>
<pre><code>sudo apt update
</code></pre>
<p>最后运行下面命令，在 Ubuntu 22.04 中安装 docker</p>
<pre><code>sudo apt install docker-ce docker-ce-cli containerd.io docker-compose-plugin
</code></pre>
<p>安装完成之后，运行下面命令验证 docker 服务正在运行：</p>
<pre><code>systemctl status docker
</code></pre>
<p>如果没有运行，则使用下面命令将 docker 服务启动起来：</p>
<pre><code>sudo systemctl start docker
</code></pre>
<p>将 docker 服务设置成每次重启时自动启动：</p>
<pre><code>sudo systemctl enable docker
</code></pre>
<p>运行下面命令查看 Docker 的版本：</p>
<pre><code>sudo docker version
</code></pre>
<p>终端输出：</p>
<pre><code>Client: Docker Engine - Community
 Version:           23.0.1
 API version:       1.42
 Go version:        go1.19.5
 Git commit:        a5ee5b1
 Built:             Thu Feb  9 19:47:01 2023
 OS/Arch:           linux/amd64
 Context:           default

Server: Docker Engine - Community
 Engine:
  Version:          23.0.1
  API version:      1.42 (minimum version 1.12)
  Go version:       go1.19.5
  Git commit:       bc3805a
  Built:            Thu Feb  9 19:47:01 2023
  OS/Arch:          linux/amd64
  Experimental:     false
 containerd:
  Version:          1.6.18
  GitCommit:        2456e983eb9e37e47538f59ea18f2043c9a73640
 runc:
  Version:          1.1.4
  GitCommit:        v1.1.4-0-g5fd4c4d
 docker-init:
  Version:          0.19.0
  GitCommit:        de40ad0
</code></pre>
<p>一切正常。</p>
<p>建立 docker 用户组：</p>
<pre><code>sudo groupadd docker
</code></pre>
<p>将当前用户加入 docker 组</p>
<pre><code>sudo usermod -aG docker $USER
</code></pre>
<p>关闭当前终端，重新登陆后测试 docker 是否安装正确：</p>
<pre><code>sudo docker run hello-world
</code></pre>
<p>终端输出：</p>
<pre><code>Unable to find image &#39;hello-world:latest&#39; locally
latest: Pulling from library/hello-world
b8dfde127a29: Pull complete
Digest: sha256:308866a43596e83578c7dfa15e27a73011bdd402185a84c5cd7f32a88b501a24
Status: Downloaded newer image for hello-world:latest

Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the &quot;hello-world&quot; image from the Docker Hub.
    (amd64)
 3. The Docker daemon created a new container from that image which runs the
    executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
    to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
 https://hub.docker.com/

For more examples and ideas, visit:
 https://docs.docker.com/get-started/
</code></pre>
<p>正常输出上面内容则说明安装成功。</p>
<p>Docker 安装 MySQL</p>
<p>拉取 MySQL </p>
<pre><code>docker pull mysql
</code></pre>
<p>创建用于存储配置文件文件夹：</p>
<pre><code>sudo mkdir -p /usr/local/docker/mysql/conf.d &amp;&amp; sudo mkdir -p /usr/local/docker/mysql/data
</code></pre>
<p>使用路径挂载 MySQL ：</p>
<pre><code>docker run \
--name mysql \
-d \
-p 3306:3306 \
--restart unless-stopped \
-v /usr/local/docker/mysql/data:/var/lib/mysql \
-v /usr/local/docker/mysql/conf.d:/etc/mysql.d \
-e MYSQL_ROOT_PASSWORD=123456 \
mysql
</code></pre>
<p>容器中已经挂载的镜像：</p>
<pre><code>docker ps -a
</code></pre>
<p>查看拉取过的所有镜像：</p>
<pre><code>docker images
</code></pre>
<p>停止一个运行中的容器：</p>
<pre><code>docker stop 容器ID/容器名
</code></pre>
<p>删除一个或者多个进程：</p>
<pre><code>docker rm -f 容器ID/容器名
</code></pre>
<p>删除已停止的镜像：</p>
<pre><code>docker remove 容器ID/容器名
</code></pre>
<p>获取容器日志：</p>
<pre><code>docker logs 容器ID/容器名
</code></pre>
<p>从宿主机将文件复制到docker容器中：</p>
<pre><code>docker cp /path/filename 容器ID:需要文件的地方
</code></pre>
<p>Docker 安装 Minio</p>
<p>拉取镜像：</p>
<pre><code>docker pull minio/minio
</code></pre>
<p>创建文件目录：</p>
<pre><code>sudo mkdir -p /usr/local/docker/minio/config
sudo mkdir -p /usr/local/docker/minio/data
</code></pre>
<p>运行镜像（这里只记得大概，存放命令的文件被删掉了）：</p>
<pre><code>docker run 
-p 9000:9000 -p 9090:9090 \
--net=host  \
--name minio  \
-d --restart=always   \
-e &quot;MINIO_ACCESS_KEY=minioadmin&quot; \
-e &quot;MINIO_SECRET_KEY=minioadmin&quot;  \
-v /usr/local/docker/minio/data:/data  \
-v /usr/local/docker/minio/config:/root/.minio \
/minio/minio server \
/data --console-address &quot;:9090&quot; -address &quot;:9000&quot;
</code></pre>
<p>运行成功的情况下，浏览器输入 ip:9090，进入登录页，默认账号密码为 minioadmin，在可视化界面中创建桶、用户组、下载用户获取数据的 key 和 密钥。</p>
<p>application.yml 中写入以下信息（在可视化界面中下载的文件中的信息）：</p>
<pre><code>minio:
  url: ip:9000 # 获取文件的端口
  accessKey: *** # 身份令牌（差不多这个意思）
  secretKey: *** # 用户密钥
  bucketName: public # 桶的访问权限
</code></pre>
<p>然后根据网上的教程在 springboot 项目中使用 minio：</p>
<p>创建配置文件：</p>
<pre><code>@Data
@Component
public class MinioConfig &#123;
    @Value(&quot;$&#123;minio.url&#125;&quot;)
    private String url;
    @Value(&quot;$&#123;minio.accessKey&#125;&quot;)
    private String accessKey;
    @Value(&quot;$&#123;minio.secretKey&#125;&quot;)
    private String secretKey;
    @Value(&quot;$&#123;minio.bucketName&#125;&quot;)
    private String bucketName;

    @Bean
    public MinioClient minioClient() &#123;
        return MinioClient.builder().endpoint(url).credentials(accessKey, secretKey).build();
    &#125;
&#125;
</code></pre>
<p>创建工具类，实现基本的文件操作：</p>
<pre><code>@Slf4j
@Component
public class MinioUtil &#123;
    @Resource
    private MinioConfig minioConfig;

    @Resource
    private MinioClient minioClient;

    /**
     * 检查存储桶是否存在
     *
     * @param bucketName 存储桶名称
     * @return 桶是否存在的标志
     */
    @SneakyThrows
    public boolean bucketExists(String bucketName) &#123;
        BucketExistsArgs args = BucketExistsArgs.builder().bucket(bucketName).build();
        return minioClient.bucketExists(args);
    &#125;

    /**
     * 创建存储桶
     *
     * @param bucketName 存储桶名称
     */
    @SneakyThrows
    public void makeBucket(String bucketName) &#123;
        if (!bucketExists(bucketName)) &#123;
            MakeBucketArgs args = MakeBucketArgs.builder().bucket(bucketName).build();
            minioClient.makeBucket(args);
        &#125;
    &#125;

    /**
     * 获取全部bucket
     */
    public List&lt;Bucket&gt; getAllBuckets() &#123;
        try &#123;
            List&lt;Bucket&gt; buckets = minioClient.listBuckets();
            return buckets;
        &#125; catch (Exception e) &#123;
            e.printStackTrace();
        &#125;
        return null;
    &#125;

    /**
     * 查看文件对象
     *
     * @return 存储bucket内文件对象信息
     */
    public List&lt;Item&gt; listObjects() &#123;
        Iterable&lt;Result&lt;Item&gt;&gt; results = minioClient.listObjects(
                ListObjectsArgs.builder().bucket(minioConfig.getBucketName()).build());
        List&lt;Item&gt; items = new ArrayList&lt;&gt;();
        try &#123;
            for (Result&lt;Item&gt; result : results) &#123;
                items.add(result.get());
            &#125;
        &#125; catch (Exception e) &#123;
            e.printStackTrace();
            return null;
        &#125;
        return items;
    &#125;

    /**
     * 查询单个储桶中的所有对象。
     *
     * @param bucketName 存储桶名称
     */
    public List&lt;Object&gt; listObjects(String bucketName) throws Exception &#123;
        Iterable&lt;Result&lt;Item&gt;&gt; results = minioClient.listObjects(ListObjectsArgs.builder().bucket(bucketName).build());
        Iterator&lt;Result&lt;Item&gt;&gt; iterator = results.iterator();
        List&lt;Object&gt; items = new ArrayList&lt;&gt;();
        String format = &quot;&#123;&#39;fileName&#39;:&#39;%s&#39;,&#39;fileSize&#39;:&#39;%s&#39;&#125;&quot;;
        while (iterator.hasNext()) &#123;
            Item item = iterator.next().get();
            items.add(JSON.parse(String.format(format, item.objectName(),
                    formatFileSize(item.size()))));
        &#125;
        log.info(&quot;查询单个储桶中的所有对象信息：&#123;&#125;&quot;, items);
        return items;
    &#125;

    /**
     * 列出存储桶中的所有对象
     *
     * @param bucketName 存储桶名称
     * @return
     */
    @SneakyThrows
    public Iterable&lt;Result&lt;Item&gt;&gt; listObjects1(String bucketName) &#123;
        if (bucketExists(bucketName)) &#123;
            ListObjectsArgs args = ListObjectsArgs.builder().bucket(bucketName).build();
            return minioClient.listObjects(args);
        &#125;
        return null;
    &#125;

    /**
     * 删除存储bucket
     *
     * @param bucketName 存储bucket名称
     * @return Boolean
     */
    public Boolean removeBucket(String bucketName) &#123;
        try &#123;
            minioClient.removeBucket(RemoveBucketArgs.builder()
                    .bucket(bucketName)
                    .build());
        &#125; catch (Exception e) &#123;
            e.printStackTrace();
            return false;
        &#125;
        return true;
    &#125;

    /**
     * 删除一个对象
     *
     * @param bucketName 存储桶名称
     * @param objectName 存储桶里的对象名称
     */
    @SneakyThrows
    public boolean removeObject(String bucketName, String objectName) &#123;
        if (bucketExists(bucketName)) &#123;
            RemoveObjectArgs args = RemoveObjectArgs.builder().bucket(bucketName).object(objectName).build();
            minioClient.removeObject(args);
            return true;
        &#125;
        return false;
    &#125;

    /**
     * 批量删除文件对象
     *
     * @param bucketName 存储bucket名称
     * @param objects    对象名称集合
     */
    public Iterable&lt;Result&lt;DeleteError&gt;&gt; removeObjects(String bucketName, List&lt;String&gt; objects) &#123;
        List&lt;DeleteObject&gt; dos = objects.stream().map(e -&gt; new DeleteObject(e)).collect(Collectors.toList());
        Iterable&lt;Result&lt;DeleteError&gt;&gt; results = minioClient.removeObjects(RemoveObjectsArgs.builder().bucket(bucketName).objects(dos).build());
        return results;
    &#125;

    /**
     * description: 上传文件
     *
     * @return: java.lang.String
     */
    public List&lt;String&gt; putObject(MultipartFile[] multipartFile) &#123;
        List&lt;String&gt; names = new ArrayList&lt;&gt;(multipartFile.length);
        for (MultipartFile file : multipartFile) &#123;
            String fileName = file.getOriginalFilename();
            String[] split = fileName.split(&quot;\\.&quot;);
            if (split.length &gt; 1) &#123;
                fileName = split[0] + &quot;_&quot; + System.currentTimeMillis() + &quot;.&quot; + split[1];
            &#125; else &#123;
                fileName = fileName + System.currentTimeMillis();
            &#125;
            InputStream in = null;
            try &#123;
                in = file.getInputStream();
                minioClient.putObject(PutObjectArgs.builder()
                        .bucket(minioConfig.getBucketName())
                        .object(fileName)
                        .stream(in, in.available(), -1)
                        .contentType(file.getContentType())
                        .build()
                );
            &#125; catch (Exception e) &#123;
                e.printStackTrace();
            &#125; finally &#123;
                if (in != null) &#123;
                    try &#123;
                        in.close();
                    &#125; catch (IOException e) &#123;
                        e.printStackTrace();
                    &#125;
                &#125;
            &#125;
            names.add(fileName);
        &#125;
        return names;
    &#125;

    /**
     * 文件上传
     *
     * @param file 文件
     * @return Boolean
     */
    public Boolean putObject(MultipartFile file) &#123;
        try &#123;
            PutObjectArgs objectArgs = PutObjectArgs.builder().bucket(minioConfig.getBucketName()).object(file.getOriginalFilename())
                    .stream(file.getInputStream(), file.getSize(), -1).contentType(file.getContentType()).build();
            //文件名称相同会覆盖
            minioClient.putObject(objectArgs);
        &#125; catch (Exception e) &#123;
            e.printStackTrace();
            return false;
        &#125;
        return true;
    &#125;

    /**
     * 获取文件外链
     */
    public String getObjectUrl(String fileName) &#123;
        // 查看文件地址
        GetPresignedObjectUrlArgs build = new GetPresignedObjectUrlArgs().builder().bucket(minioConfig.getBucketName()).object(fileName).method(Method.GET).build();
        try &#123;
            String url = minioClient.getPresignedObjectUrl(build);
            return url;
        &#125; catch (Exception e) &#123;
            e.printStackTrace();
        &#125;
        return null;
    &#125;

    /**
     * 获取文件外链
     */
    @SneakyThrows
    public String getObjectUrl(String bucketName, String region, String fileName) &#123;
        return minioClient.getPresignedObjectUrl(
                GetPresignedObjectUrlArgs.builder()
                        .method(Method.GET)
                        .bucket(bucketName)
                        .region(region)
                        .object(fileName)
                        .build());
    &#125;

    /**
     * description: 下载文件
     *
     * @return org.springframework.http.ResponseEntity&lt;byte [ ]&gt;
     */
    public ResponseEntity&lt;byte[]&gt; download(String fileName) &#123;
        ResponseEntity&lt;byte[]&gt; responseEntity = null;
        InputStream in = null;
        ByteArrayOutputStream out = null;
        try &#123;
            in = minioClient.getObject(GetObjectArgs.builder().bucket(minioConfig.getBucketName()).object(fileName).build());
            out = new ByteArrayOutputStream();
            IOUtils.copy(in, out);
            //封装返回值
            byte[] bytes = out.toByteArray();
            HttpHeaders headers = new HttpHeaders();
            try &#123;
                headers.add(&quot;Content-Disposition&quot;, &quot;attachment;filename=&quot; + URLEncoder.encode(fileName, &quot;UTF-8&quot;));
            &#125; catch (UnsupportedEncodingException e) &#123;
                e.printStackTrace();
            &#125;
            headers.setContentLength(bytes.length);
            headers.setContentType(MediaType.APPLICATION_OCTET_STREAM);
            headers.setAccessControlExposeHeaders(Arrays.asList(&quot;*&quot;));
            responseEntity = new ResponseEntity&lt;&gt;(bytes, headers, HttpStatus.OK);
        &#125; catch (Exception e) &#123;
            e.printStackTrace();
        &#125; finally &#123;
            try &#123;
                if (in != null) &#123;
                    try &#123;
                        in.close();
                    &#125; catch (IOException e) &#123;
                        e.printStackTrace();
                    &#125;
                &#125;
                if (out != null) &#123;
                    out.close();
                &#125;
            &#125; catch (IOException e) &#123;
                e.printStackTrace();
            &#125;
        &#125;
        return responseEntity;
    &#125;

    /**
     * 文件下载
     *
     * @param fileName 文件名称
     * @param res      response
     */
    public void download(String fileName, HttpServletResponse res) &#123;
        GetObjectArgs objectArgs = GetObjectArgs.builder().bucket(minioConfig.getBucketName())
                .object(fileName).build();
        try (GetObjectResponse response = minioClient.getObject(objectArgs)) &#123;
            byte[] buf = new byte[1024];
            int len;
            try (FastByteArrayOutputStream os = new FastByteArrayOutputStream()) &#123;
                while ((len = response.read(buf)) != -1) &#123;
                    os.write(buf, 0, len);
                &#125;
                os.flush();
                byte[] bytes = os.toByteArray();
                res.setCharacterEncoding(&quot;utf-8&quot;);
                // 设置强制下载不打开
                // res.setContentType(&quot;application/force-download&quot;);
                res.addHeader(&quot;Content-Disposition&quot;, &quot;attachment;fileName=&quot; + fileName);
                try (ServletOutputStream stream = res.getOutputStream()) &#123;
                    stream.write(bytes);
                    stream.flush();
                &#125;
            &#125;
        &#125; catch (Exception e) &#123;
            e.printStackTrace();
        &#125;
    &#125;

    public static String formatFileSize(long fileS) &#123;
        DecimalFormat df = new DecimalFormat(&quot;#.00&quot;);
        String fileSizeString;
        String wrongSize = &quot;0B&quot;;
        if (fileS == 0) &#123;
            return wrongSize;
        &#125;
        if (fileS &lt; 1024) &#123;
            fileSizeString = df.format((double) fileS) + &quot; B&quot;;
        &#125; else if (fileS &lt; 1048576) &#123;
            fileSizeString = df.format((double) fileS / 1024) + &quot; KB&quot;;
        &#125; else if (fileS &lt; 1073741824) &#123;
            fileSizeString = df.format((double) fileS / 1048576) + &quot; MB&quot;;
        &#125; else &#123;
            fileSizeString = df.format((double) fileS / 1073741824) + &quot; GB&quot;;
        &#125;
        return fileSizeString;
    &#125;
&#125;
</code></pre>
<p>最后是根据项目业务实现的控制器：</p>
<pre><code>@CrossOrigin
@RestController
@RequestMapping(&quot;/api/file&quot;)
@Slf4j
public class UploadController &#123;
    @Resource
    private MinioConfig minioProperties;

    @Resource
    private MinioUtil util;

    @GetMapping(&quot;/list&quot;)
    public Result list() throws Exception &#123;
        return Result.success(util.listObjects(minioProperties.getBucketName()));
    &#125;

    @PostMapping(&quot;/upload&quot;)
    public Result uploadFile(MultipartFile file) &#123;
        try &#123;
            String fileName = file.getOriginalFilename();
            // 可能会抛出异常
            assert fileName != null;
            
            util.putObject(file);

            String[] split = util.getObjectUrl(fileName).split(&quot;\\?&quot;);

            return Result.success(split[0]);
        &#125; catch (Exception e) &#123;
            e.printStackTrace();
            return Result.fail(&quot;上传失败&quot;);
        &#125;
    &#125;

    @DeleteMapping(&quot;/delete/&#123;fileName&#125;&quot;)
    public Result deleteFile(@PathVariable(&quot;fileName&quot;) String fileName) &#123;
        boolean status = util.removeObject(minioProperties.getBucketName(), fileName);
        return status ? Result.success(&quot;删除成功&quot;) : Result.fail(&quot;删除失败&quot;);
    &#125;
&#125;
</code></pre>
<p>基本完成。</p>
<p>Docker 安装 Redis</p>
<p>拉取 Redis 镜像：</p>
<pre><code>docker pull redis
</code></pre>
<p>运行上面命令拉取 redis 最新版镜像。</p>
<p>下载 redis 配置文件并解压，下载链接：<a target="_blank" rel="noopener" href="http://www.redis.cn/download.html%EF%BC%8C%E4%B8%8B%E8%BD%BD%E7%A8%B3%E5%AE%9A%E7%89%88%E5%8D%B3%E5%8F%AF">http://www.redis.cn/download.html，下载稳定版即可</a></p>
<p>上传文件之后在合适的地方解压。</p>
<pre><code>sudo mkdir -p /usr/local/docker/redis/config
sudo mkdir -p /usr/local/docker/redis/data
</code></pre>
<p>将解压后的文件夹中的 redis.conf 文件复制到 redis/config 文件夹下，然后使用 vim 修改其中的配置信息：</p>
<ul>
<li>注释掉 bind 127.0.0.1 这个语句</li>
<li>修改 requirepass 之后跟随的密码</li>
</ul>
<p>命令行运行：</p>
<pre><code>docker run \
--restart=always \
--log-opt max-size=100m \
--log-opt max-file=2 \
-p 6379:6379 \
--name redis \
-v /usr/local/docker/redis/redis.conf:/etc/redis/redis.conf \
-v /usr/local/docker/redis/data:/data \
-d redis redis-server \
/etc/redis/redis.conf \
--appendonly yes \
--requirepass password
</code></pre>
<p>或者是：</p>
<pre><code>docker run --restart=always --log-opt max-size=100m --log-opt max-file=2 -p 6379:6379 --name redis -v /usr/local/docker/redis/redis.conf:/etc/redis/redis.conf -v /usr/local/docker/redis/data:/data -d redis redis-server /etc/redis/redis.conf --appendonly yes --requirepass password
</code></pre>
<p>使用 docker exec  -it redis redis-cli 命令进入到容器内部。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://Zuowanghang.github.io">含光</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://zuowanghang.github.io/2023/03/25/Docker-%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/">https://zuowanghang.github.io/2023/03/25/Docker-%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2023/02/19/MySQL%E6%9B%B4%E6%94%B9%E8%AE%B0/" title="MySQL更改记"><img class="cover" src="https://s2.loli.net/2023/03/08/9waDWSj7yLAhNnX.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">MySQL更改记</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://s2.loli.net/2022/11/30/m3onYl1iO4ZuwT8.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">含光</div><div class="author-info__description">有朋自远方来，不亦乐乎</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">6</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Zuowanghang"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Zuowanghang" target="_blank" title="Github"><i class="fab fa-github"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">技术小栈</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/03/25/Docker-%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/" title="No title"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="No title"/></a><div class="content"><a class="title" href="/2023/03/25/Docker-%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/" title="No title">No title</a><time datetime="2023-03-25T14:11:38.816Z" title="Created 2023-03-25 22:11:38">2023-03-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/02/19/MySQL%E6%9B%B4%E6%94%B9%E8%AE%B0/" title="MySQL更改记"><img src="https://s2.loli.net/2023/03/08/9waDWSj7yLAhNnX.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL更改记"/></a><div class="content"><a class="title" href="/2023/02/19/MySQL%E6%9B%B4%E6%94%B9%E8%AE%B0/" title="MySQL更改记">MySQL更改记</a><time datetime="2023-02-19T08:05:57.000Z" title="Created 2023-02-19 16:05:57">2023-02-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/12/05/Spring/" title="Spring"><img src="https://s2.loli.net/2023/03/08/7Y9Z5zTQL4UFX1S.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spring"/></a><div class="content"><a class="title" href="/2022/12/05/Spring/" title="Spring">Spring</a><time datetime="2022-12-05T06:51:15.000Z" title="Created 2022-12-05 14:51:15">2022-12-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/11/Java-Web/" title="Java Web"><img src="https://s2.loli.net/2023/03/08/KtyIJoiUDauNTjb.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java Web"/></a><div class="content"><a class="title" href="/2022/11/11/Java-Web/" title="Java Web">Java Web</a><time datetime="2022-11-11T11:44:02.000Z" title="Created 2022-11-11 19:44:02">2022-11-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/11/C-Plus-Plus/" title="C Plus Plus"><img src="https://s2.loli.net/2022/11/30/bla2mxhQ9jwJMGO.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="C Plus Plus"/></a><div class="content"><a class="title" href="/2022/04/11/C-Plus-Plus/" title="C Plus Plus">C Plus Plus</a><time datetime="2022-04-11T04:07:50.000Z" title="Created 2022-04-11 12:07:50">2022-04-11</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By 含光</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"left"},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>